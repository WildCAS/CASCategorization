{% load staticfiles %}

<!doctype html>
<html>
  <head>
    <title>Hi {{name}}!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static "journal/dashboard/style.css" %}">

    <!-- Google Font Lato -->
    <link href="https://fonts.googleapis.com/css?family=Lato:400,300,700" rel="stylesheet" type="text/css">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <!-- Tether -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.3.1/js/tether.min.js"></script>

    <!-- The core React library -->
    <script src="https://fb.me/react-15.1.0.js"></script>
    <!-- The ReactDOM Library -->
    <script src="https://fb.me/react-dom-15.1.0.js"></script>

    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <!-- D3 -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  </head>
  <body id="main">
    <div class="container" id="dash"></div>
    <script type="text/babel">
      var Dashboard = React.createClass({
        loadStatsFromServer: function() {
          $.ajax({
            url: this.props.url,
            dataType: 'json',
            cache: true,
            success: function(data) {
              this.setState({
                name: data.name,
                learning_objectives: data.learning_objectives,
                cas: data.cas,
                requirements: data.requirements
              });
            }.bind(this),
            error: function(xhr, status, err) {
              console.error(this.props.url, status, err.toString());
            }.bind(this)
          });
        },
        componentDidMount: function() {
          this.loadStatsFromServer();
        },
        componentWillUnmount: function() {
          this.serverRequest.abort();
        },
        getInitialState: function() {
          return {
            name: '',
            learning_objectives: [],
            cas: [],
            requirements: {
              learning_objectives: [1, 1, 1, 1, 1, 1, 1, 1],
              cas: [1, 1, 1]
            }
          };
        },
        hasActivities: function() {
          var total = this.state.cas.reduce(function(a, b) {
            return a + b;
          }, 0);
          return total != 0
        },
        showCasStats: function() {
          var displayCasStyle = [];
          for(var i = 0; i < this.state.cas.length; i++) {
            if (parseInt(this.state.cas[i]) > 0) {
              displayCasStyle[i] = {
                color: '#00BBBB',
                fontWeight: 'bold'
              };
            }
          }
          return (
            <div className="cas-display">
              <span id="creativity" style={displayCasStyle[0]}> C </span>
              <span id="action" style={displayCasStyle[1]}> A </span>
              <span id="service" style={displayCasStyle[2]}> S </span>
            </div>
          );
        },
        showLearningObjectiveStats: function() {
          return (
            <div>
              <div> Awareness </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.0 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.0 }}%'} }>
                  {{ progress.0 }}%
                </div>
              </div>
              <div> Growth </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.1 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.1 }}%'} }>
                  {{ progress.1 }}%
                </div>
              </div>
              <div> Planning  </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.2 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.2 }}%'} }>
                  {{ progress.2 }}%
                </div>
              </div>
              <div> Collaboration  </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.3 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.3 }}%'} }>
                  {{ progress.3 }}%
                </div>
              </div>
              <div> Ethics </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.4 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.4 }}%'} }>
                  {{ progress.4 }}%
                </div>
              </div>
              <div> Challenges </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.5 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.5 }}%'} }>
                  {{ progress.5 }}%
                </div>
              </div>
              <div> Commitment </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.6 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.6 }}%'} }>
                  {{ progress.6 }}%
                </div>
              </div>
              <div> Globalization </div>
              <div className="progress">
                <div className="progress-bar" role="progressbar" aria-valuenow="{{ progress.7 }}" aria-valuemin="0" aria-valuemax="100" style={ {width: '{{ progress.7 }}%'} }>
                  {{ progress.7 }}%
                </div>
              </div>
            </div>
          );
        },
        render: function() {
          return (
            <div className="dashboard">
              <div className="row">
                <div className="col-sm-12 col-md-6">
                  <h1> Hi {this.state.name}! </h1>
                </div>
                <div className="col-sm-12 col-md-6" id="action-buttons-container">
                  <div className="btn-group" id="action-buttons">
                    <a type="button" className="btn btn-default"> Add an activity </a>
                    <a type="button" className="btn btn-primary"> Add an entry </a>
                  </div>
                </div>
              </div>
              <div className="row">
                <div className="col-sm-12 col-md-6 col-lg-5">
                  <h2> CAS Completion </h2>
                  {this.showCasStats()}
                </div>
                <div className="col-sm-12 col-md-6 col-lg-7">
                  <h2> Learning Objectives </h2>
                  {this.showLearningObjectiveStats()}
                </div>
              </div>
              <div className="row">
                <div className="col-sm-12 col-md-6 col-lg-5">
                  <h2> Notifications </h2>
                  <div> Nothing to tell you yet! </div>
                </div>
              </div>
            </div>
          );
        }
      });

      ReactDOM.render(
        <Dashboard url="/dashboard_handler" pollInterval="200"/>,
        document.getElementById('dash')
      );
    </script>
    <script src="{% static 'journal/dashboard/draw.js' %}"></script>
  </body>
</html>
